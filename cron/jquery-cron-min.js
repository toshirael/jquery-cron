!function(e){for(var t={initial:"0 0/1 * * * ?",every:"Every",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:void 0,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:void 0,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:void 0,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:void 0,title:void 0},dowOpts:{minWidth:100,itemWidth:void 0,columns:void 0,rows:void 0,title:void 0},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:void 0,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:void 0,customValues:void 0,onChange:void 0,useGentleSelect:!1},n="",i=0;i<60;i++){n+="<option value='"+i+"'>"+(i<10?"0":"")+i+"</option>\n"}var s="";for(i=0;i<24;i++){s+="<option value='"+i+"'>"+(i<10?"0":"")+i+"</option>\n"}var r="";for(i=1;i<32;i++){if(1==i||21==i||31==i)var a="st";else if(2==i||22==i)a="nd";else if(3==i||23==i)a="rd";else a="th";r+="<option value='"+i+"'>"+i+a+"</option>\n"}var l="",c=["January","February","March","April","May","June","July","August","September","October","November","December"];for(i=0;i<c.length;i++)l+="<option value='"+(i+1)+"'>"+c[i]+"</option>\n";var d="",u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(i=0;i<u.length;i++)d+="<option value='"+(i+1)+"'>"+u[i]+"</option>\n";var m="",h=["minute","hour","day","week","month","year"];for(i=0;i<h.length;i++)m+="<option value='"+h[i]+"'>"+h[i]+"</option>\n";var p={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]},v={minute:/^0\s(0\/1)\s(\*\s){3}\?$/,hour:/^0\s\d{1,2}\s(0\/1)\s(\*\s){2}\?$/,day:/^0\s(\d{1,2}\s){2}(\*\s){2}\?$/,week:/^0\s(\d{1,2}\s){2}\?\s(\*\s)\d{1,2}$/,month:/^0\s(\d{1,2}\s){3}\*\s\?$/,year:/^0\s(\d{1,2}\s){4}\?\s\*$/};function f(e){return void 0!==e}function y(t,n){if(f(n.customValues))for(key in n.customValues)if(t==n.customValues[key])return key;if("string"==typeof t&&/^0\s(0\/1|\d{1,2})\s(0\/1|\d{1,2}|\*)\s(\d{1,2}|\*|\?)\s(\d{1,2}|\*)\s(\d{1,2}|\?)(\s\*)?$/.test(t)){var i=t.split(" ");i=i.splice(1,i.length-1);for(var s=[0,0,1,1,1],r=[59,23,31,12,7],a=0;a<i.length;a++)if("*"!=i[a]&&!/^0\/1$/.test(i[a])&&"?"!=i[a]){var l=parseInt(i[a]);if(!(f(l)&&l<=r[a]&&l>=s[a]))return void e.error("cron: invalid value found (col "+(a+1)+") in "+o.initial)}for(var c in v)if(v[c].test(t))return c;e.error("cron: valid but unsupported cron format. sorry.")}else e.error("cron: invalid initial value")}function g(t,o){if(!f(y(o.initial,o)))return!0;if(f(n=o.customValues)&&"object"!=typeof n)return!0;var n;if(f(o.customValues))for(key in o.customValues)if(v.hasOwnProperty(key))return e.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}var O={init:function(o){var i=o||{},a=e.extend([],t,i),c=e.extend({},t.effectOpts,i.effectOpts);if(e.extend(a,{minuteOpts:e.extend({},t.minuteOpts,c,i.minuteOpts),domOpts:e.extend({},t.domOpts,c,i.domOpts),monthOpts:e.extend({},t.monthOpts,c,i.monthOpts),dowOpts:e.extend({},t.dowOpts,c,i.dowOpts),timeHourOpts:e.extend({},t.timeHourOpts,c,i.timeHourOpts),timeMinuteOpts:e.extend({},t.timeMinuteOpts,c,i.timeMinuteOpts)}),g(0,a))return this;var u=[],h="",p=a.customValues;if(f(p))for(var v in p)h+="<option value='"+p[v]+"'>"+v+"</option>\n";u.period=e("<span class='cron-period'>"+a.every+" <select name='cron-period'>"+h+m+"</select> </span>").appendTo(this).data("root",this);var y=u.period.find("select");return y.bind("change.cron",b.periodChanged).data("root",this),a.useGentleSelect&&y.gentleSelect(c),u.dom=e("<span class='cron-block cron-block-dom'> on the <select name='cron-dom'>"+r+"</select> </span>").appendTo(this).data("root",this),y=u.dom.find("select").data("root",this),a.useGentleSelect&&y.gentleSelect(a.domOpts),u.month=e("<span class='cron-block cron-block-month'> of <select name='cron-month'>"+l+"</select> </span>").appendTo(this).data("root",this),y=u.month.find("select").data("root",this),a.useGentleSelect&&y.gentleSelect(a.monthOpts),u.mins=e("<span class='cron-block cron-block-mins'> at <select name='cron-mins'>"+n+"</select> minutes past the hour </span>").appendTo(this).data("root",this),y=u.mins.find("select").data("root",this),a.useGentleSelect&&y.gentleSelect(a.minuteOpts),u.dow=e("<span class='cron-block cron-block-dow'> on <select name='cron-dow'>"+d+"</select> </span>").appendTo(this).data("root",this),y=u.dow.find("select").data("root",this),a.useGentleSelect&&y.gentleSelect(a.dowOpts),u.time=e("<span class='cron-block cron-block-time'> at <select name='cron-time-hour' class='cron-time-hour'>"+s+"</select>:<select name='cron-time-min' class='cron-time-min'>"+n+" </span>").appendTo(this).data("root",this),y=u.time.find("select.cron-time-hour").data("root",this),a.useGentleSelect&&y.gentleSelect(a.timeHourOpts),y=u.time.find("select.cron-time-min").data("root",this),a.useGentleSelect&&y.gentleSelect(a.timeMinuteOpts),u.controls=e("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",b.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",b.somethingChanged),this.data("options",a).data("block",u),this.data("current_value",a.initial),O.value.call(this,a.initial)},value:function(e){if(!e)return function(e){var t=e.data("block"),o=hour=day=month=dow="*",n=t.period.find("select").val();switch(n){case"minute":return["0","0/1","*","*","*","?"].join(" ");case"hour":return["0",o=t.mins.find("select").val(),"0/1","*","*","?"].join(" ");case"day":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),["0",o,hour,"*","*","?"].join(" ");case"week":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),dow=t.dow.find("select").val(),["0",o,hour,"?","*",dow].join(" ");case"month":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),["0",o,hour,day,"*","?"].join(" ");case"year":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),month=t.month.find("select").val(),["0",o,hour,day,month,"?","*"].join(" ");default:return n}}(this);var t=this.data("options"),o=this.data("block"),n=t.useGentleSelect,i=y(e,t);if(!f(i))return!1;if(f(t.customValues)&&t.customValues.hasOwnProperty(i))i=t.customValues[i];else{var s=e.split(" ");s=s.splice(1,s.length-1);for(var r=0;r<s.length;r++)/^0\/1$/.test(s[r])&&(s[r]=void 0),"?"===s[r]&&(s[r]=void 0);var a={mins:s[0],hour:s[1],dom:s[2],month:s[3],dow:s[4]},l=p[i];for(r=0;r<l.length;r++){var c=l[r];if("time"==c){var d=o[c].find("select.cron-time-hour").val(a.hour);n&&d.gentleSelect("update"),d=o[c].find("select.cron-time-min").val(a.mins),n&&d.gentleSelect("update")}else{d=o[c].find("select").val(a[c]);n&&d.gentleSelect("update")}}}var u=o.period.find("select").val(i);return n&&u.gentleSelect("update"),u.trigger("change"),this}},b={periodChanged:function(){var t=e(this).data("root"),o=t.data("block"),n=(t.data("options"),e(this).val());if(t.find("span.cron-block").hide(),p.hasOwnProperty(n))for(var i=p[e(this).val()],s=0;s<i.length;s++)o[i[s]].show()},somethingChanged:function(){root=e(this).data("root"),f(root.data("options").url_set)?O.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var t=root.data("options").onChange;f(t)&&e.isFunction(t)&&t.call(root)},saveClicked:function(){var t=e(this),o=t.data("root"),n=O.value.call(o);t.hasClass("cron-loading")||(t.addClass("cron-loading"),e.ajax({type:"POST",url:o.data("options").url_set,data:{cron:n},success:function(){o.data("current_value",n),t.removeClass("cron-loading"),n==O.value.call(o)&&(o.removeClass("cron-changed"),o.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),t.removeClass("cron-loading")}}))}};e.fn.cron=function(t){return O[t]?O[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.cron"):O.init.apply(this,arguments)}}(jQuery);